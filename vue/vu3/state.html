<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sharing State | Hello ;)</title>
    <meta name="description" content="Just playing around">
    <meta name="generator" content="VuePress 1.3.0">
    
    
    <link rel="preload" href="/notes-tips/assets/css/0.styles.d0e609a8.css" as="style"><link rel="preload" href="/notes-tips/assets/js/app.557ce569.js" as="script"><link rel="preload" href="/notes-tips/assets/js/2.d0218362.js" as="script"><link rel="preload" href="/notes-tips/assets/js/25.2cf37cc2.js" as="script"><link rel="prefetch" href="/notes-tips/assets/js/10.5b08dcb9.js"><link rel="prefetch" href="/notes-tips/assets/js/11.43ade1ee.js"><link rel="prefetch" href="/notes-tips/assets/js/12.f8bc895e.js"><link rel="prefetch" href="/notes-tips/assets/js/13.24d9da50.js"><link rel="prefetch" href="/notes-tips/assets/js/14.251b784d.js"><link rel="prefetch" href="/notes-tips/assets/js/15.70e2dcbb.js"><link rel="prefetch" href="/notes-tips/assets/js/16.a770eeac.js"><link rel="prefetch" href="/notes-tips/assets/js/17.ec392fa7.js"><link rel="prefetch" href="/notes-tips/assets/js/18.6ad3cce7.js"><link rel="prefetch" href="/notes-tips/assets/js/19.c437d1ea.js"><link rel="prefetch" href="/notes-tips/assets/js/20.3818af9a.js"><link rel="prefetch" href="/notes-tips/assets/js/21.c71aa5ff.js"><link rel="prefetch" href="/notes-tips/assets/js/22.3fdbb1e5.js"><link rel="prefetch" href="/notes-tips/assets/js/23.62dfaa37.js"><link rel="prefetch" href="/notes-tips/assets/js/24.5fac8cff.js"><link rel="prefetch" href="/notes-tips/assets/js/26.52485140.js"><link rel="prefetch" href="/notes-tips/assets/js/27.636c97a8.js"><link rel="prefetch" href="/notes-tips/assets/js/28.a0f23262.js"><link rel="prefetch" href="/notes-tips/assets/js/3.570f6e99.js"><link rel="prefetch" href="/notes-tips/assets/js/4.b9e1cdb8.js"><link rel="prefetch" href="/notes-tips/assets/js/5.74eeff93.js"><link rel="prefetch" href="/notes-tips/assets/js/6.095a5b90.js"><link rel="prefetch" href="/notes-tips/assets/js/7.fc4a63bc.js"><link rel="prefetch" href="/notes-tips/assets/js/8.75653bce.js"><link rel="prefetch" href="/notes-tips/assets/js/9.62c92631.js">
    <link rel="stylesheet" href="/notes-tips/assets/css/0.styles.d0e609a8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/notes-tips/" class="home-link router-link-active"><!----> <span class="site-name">Hello ;)</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/notes-tips/" class="nav-link">
  Init
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/notes-tips/" class="nav-link">
  Init
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/notes-tips/" class="sidebar-link">Tips documentation</a></li><li><a href="/notes-tips/javascript/" class="sidebar-link">Javascript</a></li><li><a href="/notes-tips/vue/" class="sidebar-link">Vue</a></li><li><a href="/notes-tips/docker/" class="sidebar-link">Docker</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h3 id="sharing-state"><a href="#sharing-state" class="header-anchor">#</a> Sharing State</h3> <p>Now that weâ€™ve learned the basic syntax of the Composition API, letâ€™s use it to extract some reusable code from a component. When working with API calls, quite often thereâ€™s a lot of code and functionality that we might want to build around a call. Specifically things like loading state, error state, and try / catch blocks. Letâ€™s look at this code and then extract it properly using the Composition API.</p> <p>Iâ€™ve built out the code sample from the previous lesson:</p> <p>ðŸ“„ /src/App.js</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;template&gt;
  &lt;div&gt;
    Search for &lt;input v-model=&quot;searchInput&quot; /&gt; 
    &lt;div&gt;
      &lt;p&gt;Loading: {{ loading }}&lt;/p&gt;
      &lt;p&gt;Error: {{ error }}&lt;/p&gt;
      &lt;p&gt;Number of events: {{ results }}&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
import { ref, watch } from &quot;@vue/composition-api&quot;;
import eventApi from &quot;@/api/event.js&quot;;
export default {
  setup() {
    const searchInput = ref(&quot;&quot;);
    const results = ref(null);
    const loading = ref(false);
    const error = ref(null);
    async function loadData(search) {
      loading.value = true;
      error.value = null;
      results.value = null;
      try {
        results.value = await eventApi.getEventCount(search.value);
      } catch (err) {
        error.value = err;
      } finally {
        loading.value = false;
      }
    }
    watch(searchInput, () =&gt; {
      if (searchInput.value !== &quot;&quot;) {
        loadData(searchInput);
      } else {
        results.value = null;
      }
    });
    return { searchInput, results, loading, error };
  }
};
&lt;/script&gt;
</code></pre></div><p>Now with Shared State
This is a pretty common pattern in a Vue application where I have an API call and I need to account for the results, loading, and error state. How might I extract this to use the composition API? Well first I might create a new file and extract the common functionality.</p> <p>ðŸ“„ /composables/use-promise.js</p> <div class="language- extra-class"><pre class="language-text"><code>import { ref } from &quot;@vue/composition-api&quot;;
export default function usePromise(fn) { // fn is the actual API call
  const results = ref(null);
  const loading = ref(false);
  const error = ref(null);
  const createPromise = async (...args) =&gt; { // Args is where we send in searchInput
    loading.value = true;
    error.value = null;
    results.value = null;
    try {
      results.value = await fn(...args); // Passing through the SearchInput
    } catch (err) {
      error.value = err;
    } finally {
      loading.value = false;
    }
  };
  return { results, loading, error, createPromise };
}
</code></pre></div><p>Notice how this function holds the reactive references as well as a function that wraps the API call, along with any arguments that need to be passed into the API call. Now to use this code:</p> <p>ðŸ“„ /src/App.js</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;template&gt;
  &lt;div&gt;
    Search for &lt;input v-model=&quot;searchInput&quot; /&gt; 
    &lt;div&gt;
      &lt;p&gt;Loading: {{ getEvents.loading }}&lt;/p&gt;
      &lt;p&gt;Error: {{ getEvents.error }}&lt;/p&gt;
      &lt;p&gt;Number of events: {{ getEvents.results }}&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
import { ref, watch } from &quot;@vue/composition-api&quot;;
import eventApi from &quot;@/api/event.js&quot;;
import usePromise from &quot;@/composables/use-promise&quot;;
export default {
  setup() {
    const searchInput = ref(&quot;&quot;);
    const getEvents = usePromise(search =&gt;
      eventApi.getEventCount(search.value)
    );

    watch(searchInput, () =&gt; {
      if (searchInput.value !== &quot;&quot;) {
        getEvents.createPromise(searchInput);
      } else {
        getEvents.results.value = null;
      }
    });
    return { searchInput, getEvents };
  }
};
&lt;/script&gt;
</code></pre></div><p>Thatâ€™s all there is to it, and we get the same functionality shown above.</p> <p>Notice in particular how easy it is to have reactive state (loading, error, and results) that lives inside my use-promise.js file which gets used inside my component. Now when I have another API call I can use-promise.</p> <p>Caveat
When I ran this by members of the Vue core team, they called attention to â€¦getEvents. Specifically that I shouldnâ€™t be destructuring the object. Without destructuring the data is namespaced under getEvents which makes it more encapsulated and clear where the data is coming from in the component using it. It might look like:</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;template&gt;
  &lt;div&gt;
    Search for &lt;input v-model=&quot;searchInput&quot; /&gt; 
    &lt;div&gt;
      &lt;p&gt;Loading: {{ getEvents.loading }}&lt;/p&gt;
      &lt;p&gt;Error: {{ getEvents.error }}&lt;/p&gt;
      &lt;p&gt;Number of events: {{ getEvents.results }}&lt;/p&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
...
export default {
  setup() {
    ...
    return { searchInput, getEvents };
  }
};
&lt;/script&gt;
</code></pre></div><p>It looks like Vue 2 with the composition API isnâ€™t properly recognizing my Reactive References and calling .value like it should. I could fix this by adding .value manually orr by actually using Vue 3. I tested the code with Vue 3 and sure enough, it saw the Reactive References and properly displayed the .value.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/notes-tips/assets/js/app.557ce569.js" defer></script><script src="/notes-tips/assets/js/2.d0218362.js" defer></script><script src="/notes-tips/assets/js/25.2cf37cc2.js" defer></script>
  </body>
</html>
